// Til tarjimalari
const translations = {
    'en': {
        'welcome_title': 'Welcome! I am a professional Freelancer',
        'welcome_text': 'I can provide you with precise help. I will complete your work accurately and on time. Comprehensive services and quality results',
        'services_btn': 'My Services',
        'contact_btn': 'Contact',
        'services_title': 'Service Packages',
        'package1_title': 'Website Setup and Bug Fixing',
        'package1_desc': 'Setup of your existing websites, bug fixing and optimization services',
        'package1_feature1': 'Bug fixing',
        'package1_feature2': 'Website acceleration',
        'package1_feature3': 'Mobile optimization',
        'package1_feature4': 'Security enhancement',
        'package1_price': 'Starting from $50',
        'package2_title': 'Web Design',
        'package2_desc': 'Modern, attractive and user-friendly web designs',
        'package2_feature1': 'UI/UX design',
        'package2_feature2': 'Mobile design',
        'package2_feature3': 'Prototype creation',
        'package2_feature4': '3 revisions',
        'package2_price': 'Starting from $100',
        'package3_title': 'Logo Design',
        'package3_desc': 'Professional logo design for branding and corporate identity',
        'package3_feature1': '3 concepts',
        'package3_feature2': '5 revisions',
        'package3_feature3': 'PNG, SVG, AI formats',
        'package3_feature4': 'Color variants',
        'package3_price': 'Starting from $50',
        'package4_title': 'Translation Services',
        'package4_desc': 'Professional translation services in all languages',
        'package4_feature1': 'Technical translation',
        'package4_feature2': 'Literary translation',
        'package4_feature3': 'Fast delivery',
        'package4_feature4': 'Comments and explanations',
        'package4_price': '$0.05/word',
        'package5_title': 'Marketing Ideas and Branding',
        'package5_desc': 'Marketing strategies and branding for business development',
        'package5_feature1': 'Marketing strategy',
        'package5_feature2': 'Brand identity',
        'package5_feature3': 'SWOT analysis',
        'package5_feature4': 'Development plan',
        'package5_price': 'Starting from $150',
        'order_btn': 'Order Now',
        'portfolio_title': 'Portfolio',
        'portfolio1_title': 'E-commerce Website',
        'portfolio1_desc': 'Full-featured online store',
        'portfolio2_title': 'Marketing Strategy',
        'portfolio2_desc': 'Marketing plan for a new brand',
        'portfolio3_title': 'Logo Design',
        'portfolio3_desc': 'Logo for tech company',
        'portfolio4_title': 'Corporate Website',
        'portfolio4_desc': 'Website for large company',
        'portfolio5_title': 'Mobile App Design',
        'portfolio5_desc': 'App for iOS and Android',
        'about_title': 'About Me',
        'about_text1': 'I am a professional freelancer with over 5 years of experience. I have completed a wide range of projects in programming, design, translation and marketing. My main principle is individual approach to each client and providing high quality service.',
        'about_text2': 'I am happy to complete my work on time and offer solutions that meet the needs of clients. I have all the necessary knowledge and experience to successfully implement your project.',
        'completed_title': 'Completed Orders',
        'client_info': 'Client Information',
        'service_type': 'Service Type',
        'price': 'Price',
        'work_time': 'Work Time',
        'status': 'Status',
        'web_design': 'Web Design',
        'logo_design': 'Logo Design',
        'website_setup': 'Website Setup',
        'marketing_strategy': 'Marketing Strategy',
        'translation': 'Translation',
        'completed': 'Completed',
        'join_title': 'For Professional Freelancers',
        'join_text': 'If you also want to offer your services, fill out the form below',
        'join_btn': 'Join Now',
        'order_title': 'Place Order',
        'name_label': 'Your Name',
        'whatsapp_label': 'WhatsApp Number',
        'email_label': 'Email',
        'message_label': 'Additional Note (Optional)',
        'submit_btn': 'Submit',
        'join_form_title': 'Join as Professional Freelancer',
        'country_label': 'Country',
        'languages_label': 'Which Languages Do You Know?',
        'specialty_label': 'Your Specialty',
        'about_label': 'About Yourself',
        'success_title': 'Message Sent!',
        'success_text': 'Your request has been sent successfully. We will contact you shortly.'
    },
    'ru': {
        'welcome_title': 'Добро пожаловать! Я профессиональный Фрилансер',
        'welcome_text': 'Я могу предоставить вам точную помощь. Я выполню вашу работу точно и вовремя. Комплексные услуги и качественные результаты',
        'services_btn': 'Мои Услуги',
        'contact_btn': 'Контакт',
        'services_title': 'Пакеты Услуг',
        'package1_title': 'Настройка сайта и исправление ошибок',
        'package1_desc': 'Настройка ваших существующих сайтов, исправление ошибок и услуги оптимизации',
        'package1_feature1': 'Исправление ошибок',
        'package1_feature2': 'Ускорение сайта',
        'package1_feature3': 'Мобильная оптимизация',
        'package1_feature4': 'Повышение безопасности',
        'package1_price': 'От $50',
        'package2_title': 'Веб-дизайн',
        'package2_desc': 'Современный, привлекательный и удобный веб-дизайн',
        'package2_feature1': 'UI/UX дизайн',
        'package2_feature2': 'Мобильный дизайн',
        'package2_feature3': 'Создание прототипа',
        'package2_feature4': '3 правки',
        'package2_price': 'От $100',
        'package3_title': 'Дизайн логотипа',
        'package3_desc': 'Профессиональный дизайн логотипа для брендинга и корпоративной идентичности',
        'package3_feature1': '3 концепции',
        'package3_feature2': '5 правок',
        'package3_feature3': 'Форматы PNG, SVG, AI',
        'package3_feature4': 'Цветовые варианты',
        'package3_price': 'От $50',
        'package4_title': 'Услуги перевода',
        'package4_desc': 'Профессиональные услуги перевода на всех языках',
        'package4_feature1': 'Технический перевод',
        'package4_feature2': 'Литературный перевод',
        'package4_feature3': 'Быстрая доставка',
        'package4_feature4': 'Комментарии и объяснения',
        'package4_price': '$0.05/слово',
        'package5_title': 'Маркетинговые идеи и брендинг',
        'package5_desc': 'Маркетинговые стратегии и брендинг для развития бизнеса',
        'package5_feature1': 'Маркетинговая стратегия',
        'package5_feature2': 'Идентичность бренда',
        'package5_feature3': 'SWOT анализ',
        'package5_feature4': 'План развития',
        'package5_price': 'От $150',
        'order_btn': 'Заказать',
        'portfolio_title': 'Портфолио',
        'portfolio1_title': 'Интернет-магазин',
        'portfolio1_desc': 'Полнофункциональный онлайн-магазин',
        'portfolio2_title': 'Маркетинговая стратегия',
        'portfolio2_desc': 'Маркетинговый план для нового бренда',
        'portfolio3_title': 'Дизайн логотипа',
        'portfolio3_desc': 'Логотип для tech компании',
        'portfolio4_title': 'Корпоративный сайт',
        'portfolio4_desc': 'Сайт для крупной компании',
        'portfolio5_title': 'Дизайн мобильного приложения',
        'portfolio5_desc': 'Приложение для iOS и Android',
        'about_title': 'Обо мне',
        'about_text1': 'Я профессиональный фрилансер с более чем 5-летним опытом работы. Я выполнил широкий спектр проектов в области программирования, дизайна, перевода и маркетинга. Мой основной принцип - индивидуальный подход к каждому клиенту и предоставление качественных услуг.',
        'about_text2': 'Я рад выполнять свою работу вовремя и предлагать решения, соответствующие потребностям клиентов. У меня есть все необходимые знания и опыт для успешной реализации вашего проекта.',
        'completed_title': 'Выполненные заказы',
        'client_info': 'Информация о клиенте',
        'service_type': 'Тип услуги',
        'price': 'Цена',
        'work_time': 'Время работы',
        'status': 'Статус',
        'web_design': 'Веб-дизайн',
        'logo_design': 'Дизайн логотипа',
        'website_setup': 'Настройка сайта',
        'marketing_strategy': 'Маркетинговая стратегия',
        'translation': 'Перевод',
        'completed': 'Завершено',
        'join_title': 'Для профессиональных фрилансеров',
        'join_text': 'Если вы также хотите предложить свои услуги, заполните форму ниже',
        'join_btn': 'Присоединиться',
        'order_title': 'Разместить заказ',
        'name_label': 'Ваше имя',
        'whatsapp_label': 'Номер WhatsApp',
        'email_label': 'Email',
        'message_label': 'Дополнительная заметка (необязательно)',
        'submit_btn': 'Отправить',
        'join_form_title': 'Присоединиться как профессиональный фрилансер',
        'country_label': 'Страна',
        'languages_label': 'Какие языки вы знаете?',
        'specialty_label': 'Ваша специализация',
        'about_label': 'О себе',
        'success_title': 'Сообщение отправлено!',
        'success_text': 'Ваш запрос успешно отправлен. Мы свяжемся с вами в ближайшее время.'
    }
};

// DOM elementlari
const orderButtons = document.querySelectorAll('.order-btn');
const orderModal = document.getElementById('orderModal');
const joinBtn = document.getElementById('joinBtn');
const joinModal = document.getElementById('joinModal');
const successModal = document.getElementById('successModal');
const closeModalButtons = document.querySelectorAll('.close-modal');
const orderForm = document.getElementById('orderForm');
const joinForm = document.getElementById('joinForm');
const selectedPackageInput = document.getElementById('selectedPackage');
const successOk = document.getElementById('successOk');
const langButtons = document.querySelectorAll('.lang-btn');
const animatedElements = document.querySelectorAll('.animated');

// Joriy til
let currentLang = 'en';

// Tilni o'zgartirish funksiyasi
function changeLanguage(lang) {
    currentLang = lang;
    
    // Faqatgina mavjud tillarni tekshirish
    if (!translations[lang]) return;
    
    // Aktiv tugmani yangilash
    langButtons.forEach(btn => {
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Barcha tarjima qilinadigan elementlarni yangilash
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang][key]) {
            // Agar element input yoki textarea bo'lsa, value ni o'zgartirish
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.value = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
    
    // Placeholder larni yangilash
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang][key]) {
            element.setAttribute('placeholder', translations[lang][key]);
        }
    });
    
    // LocalStorage ga tilni saqlash
    localStorage.setItem('preferredLanguage', lang);
}

// Animatsiyani tekshirish
function checkAnimation() {
    animatedElements.forEach(element => {
        const elementPosition = element.getBoundingClientRect().top;
        const screenPosition = window.innerHeight / 1.3;
        
        if (elementPosition < screenPosition) {
            element.classList.add('animate');
        }
    });
}

// Formani yuborish
function handleFormSubmit(form, type) {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Agar buyurtma forması bo'lsa, paket nomini qo'shish
    if (type === 'order') {
        data.package = selectedPackageInput.value;
    }
    
    // Ma'lumotlarni local storage ga saqlash
    saveToLocalStorage(type, data);
    
    // Ma'lumotlarni serverga yuborish (simulyatsiya)
    simulateServerRequest(type, data);
    
    // Formani tozalash
    form.reset();
    
    // Muvaffaqiyat modali ko'rsatish
    successModal.style.display = 'flex';
    
    return false;
}

// Ma'lumotlarni local storage ga saqlash
function saveToLocalStorage(type, data) {
    const key = type === 'order' ? 'orders' : 'freelancers';
    const existingData = JSON.parse(localStorage.getItem(key) || '[]');
    
    // Yangi ma'lumotni qo'shish
    existingData.push({
        ...data,
        id: Date.now(),
        date: new Date().toISOString(),
        status: type === 'order' ? 'pending' : 'new'
    });
    
    // Yangilangan ma'lumotlarni saqlash
    localStorage.setItem(key, JSON.stringify(existingData));
    
    // Admin panelini yangilash (agar mavjud bo'lsa)
    if (typeof updateAdminPanel === 'function') {
        updateAdminPanel();
    }
}

// Server so'rovini simulyatsiya qilish
function simulateServerRequest(type, data) {
    console.log(`${type} formasi yuborildi:`, data);
    
    // Bu yerda haqiqiy serverga so'rov yuborishingiz mumkin
    // fetch('/api/submit-form', {
    //     method: 'POST',
    //     headers: {
    //         'Content-Type': 'application/json'
    //     },
    //     body: JSON.stringify({ type, data })
    // })
    // .then(response => response.json())
    // .then(result => {
    //     console.log('Muvaffaqiyatli yuborildi:', result);
    // })
    // .catch(error => {
    //     console.error('Xatolik:', error);
    // });
}

// Telefon raqam formatini tekshirish
function validatePhoneNumber(phone) {
    const phoneRegex = /^\+?[0-9]{7,15}$/;
    return phoneRegex.test(phone.replace(/\s/g, ''));
}

// Email formatini tekshirish
function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Formani validatsiya qilish
function validateForm(form) {
    let isValid = true;
    const inputs = form.querySelectorAll('input[required], textarea[required]');
    
    inputs.forEach(input => {
        // Telefon raqamini tekshirish
        if (input.type === 'tel' && input.value && !validatePhoneNumber(input.value)) {
            showError(input, 'Please enter a valid phone number');
            isValid = false;
        }
        
        // Emailni tekshirish
        if (input.type === 'email' && input.value && !validateEmail(input.value)) {
            showError(input, 'Please enter a valid email address');
            isValid = false;
        }
        
        // Majburiy maydonlarni tekshirish
        if (!input.value.trim()) {
            showError(input, 'This field is required');
            isValid = false;
        } else {
            clearError(input);
        }
    });
    
    return isValid;
}

// Xatolikni ko'rsatish
function showError(input, message) {
    clearError(input);
    
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.style.color = 'var(--danger)';
    errorDiv.style.fontSize = '0.8rem';
    errorDiv.style.marginTop = '5px';
    errorDiv.textContent = message;
    
    input.style.borderColor = 'var(--danger)';
    input.parentNode.appendChild(errorDiv);
}

// Xatolikni tozalash
function clearError(input) {
    const errorDiv = input.parentNode.querySelector('.error-message');
    if (errorDiv) {
        errorDiv.remove();
    }
    input.style.borderColor = '';
}

// Modalni yopish
function closeModal(modal) {
    modal.style.display = 'none';
}

// Sahifa yuklanganida ishga tushadigan funksiya
function init() {
    // LocalStorage dan saqlangan tilni o'qish
    const savedLanguage = localStorage.getItem('preferredLanguage');
    if (savedLanguage && translations[savedLanguage]) {
        changeLanguage(savedLanguage);
    }
    
    // Animatsiyalarni ishga tushirish
    checkAnimation();
    
    // Scroll bo'yicha animatsiyalarni tekshirish
    window.addEventListener('scroll', checkAnimation);
    
    // Buyurtma tugmalariga hodisa qo'shish
    orderButtons.forEach(button => {
        button.addEventListener('click', () => {
            const packageName = button.getAttribute('data-package');
            selectedPackageInput.value = packageName;
            orderModal.style.display = 'flex';
        });
    });
    
    // Qo'shilish tugmasiga hodisa qo'shish
    joinBtn.addEventListener('click', () => {
        joinModal.style.display = 'flex';
    });
    
    // Modal yopish tugmalari
    closeModalButtons.forEach(button => {
        button.addEventListener('click', () => {
            const modal = button.closest('.modal');
            closeModal(modal);
        });
    });
    
    // Formalar yuborilganda
    orderForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (validateForm(orderForm)) {
            handleFormSubmit(orderForm, 'order');
        }
    });
    
    joinForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (validateForm(joinForm)) {
            handleFormSubmit(joinForm, 'freelancer');
        }
    });
    
    // Muvaffaqiyat modali
    successOk.addEventListener('click', () => {
        closeModal(successModal);
    });
    
    // Til almashish tugmalari
    langButtons.forEach(button => {
        button.addEventListener('click', () => {
            const lang = button.getAttribute('data-lang');
            changeLanguage(lang);
        });
    });
    
    // Tashqi joyni bosganda modalni yopish
    window.addEventListener('click', (e) => {
        if (e.target === orderModal) closeModal(orderModal);
        if (e.target === joinModal) closeModal(joinModal);
        if (e.target === successModal) closeModal(successModal);
    });
    
    // Navigation menyusi uchun aktiv holat
    const sections = document.querySelectorAll('section');
    const navLinks = document.querySelectorAll('.nav-links a');
    
    window.addEventListener('scroll', () => {
        let current = '';
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            
            if (pageYOffset >= sectionTop - 100) {
                current = section.getAttribute('id');
            }
        });
        
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').substring(1) === current) {
                link.classList.add('active');
            }
        });
    });
    
    // Smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            if (targetId === '#') return;
            
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// DOM kontent yuklanganida ishga tushirish
document.addEventListener('DOMContentLoaded', init);

// Global funksiyalar
window.changeLanguage = changeLanguage;
window.validateForm = validateForm;
window.closeModal = closeModal;

// Admin panel funksiyalari (agar kerak bo'lsa)
if (typeof window.updateAdminPanel === 'undefined') {
    window.updateAdminPanel = function() {
        console.log('Admin panel yangilandi');
        // Bu funksiya admin panelida chaqiriladi
    };
}
