document.addEventListener('DOMContentLoaded', () => {
    // Eski kodlaringiz shu yerda tursin
    console.log("Frontend script yuklandi ‚úÖ");

    const orderForm = document.getElementById('orderForm');

    if (orderForm) {
        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Forma qiymatlarini olish
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const service = document.getElementById('service').value.trim();
            const date = document.getElementById('date').value.trim();

            const order = { name, phone, service, date };

            try {
                // üöÄ Yangi qism: buyurtmani serverga yuborish
                const response = await fetch('http://localhost:3000/api/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(order)
                });

                const result = await response.json();
                alert(result.message || "Buyurtma yuborildi ‚úÖ");

                // Forma tozalash
                orderForm.reset();
            } catch (error) {
                console.error('‚ùå Buyurtma yuborishda xatolik:', error);
                alert('Buyurtma yuborishda muammo yuz berdi.');
            }
        });
    }

    // Agar boshqa eski funksiyalar bo‚Äòlsa, ular shu yerda turadi
});
  
// Language Data
const translations = {
    en: {
        home: "Home",
        services: "Services",
        about: "About",
        portfolio: "Portfolio",
        heroTitle: "Professional Freelance Services",
        heroDesc: "High-quality freelance services with attention to detail and fast turnaround times. Available in multiple languages.",
        servicesBtn: "My Services",
        contactBtn: "Contact Me",
        servicesTitle: "My Services",
        service1: "Translation Work",
        service1Desc: "Professional translation services in multiple languages with accuracy and cultural sensitivity.",
        service2: "Web Design",
        service2Desc: "Custom website designs that are responsive, user-friendly, and visually appealing.",
        service3: "Logo Design",
        service3Desc: "Unique and memorable logo designs that represent your brand identity.",
        service4: "Website Improvement",
        service4Desc: "Enhance your existing website with improved functionality and modern design.",
        service5: "Brand Development",
        service5Desc: "Comprehensive brand development services to establish your market presence.",
        service6: "3D Business Cards",
        service6Desc: "Innovative 3D business card designs that leave a lasting impression.",
        service7: "3D Models",
        service7Desc: "Detailed 3D modeling services for various applications and industries.",
        service8: "Banners & Advertising",
        service8Desc: "Eye-catching banners and advertising materials for books, promotions, and events.",
        orderNow: "Order Now",
        aboutTitle: "About Me",
        aboutSubtitle: "Ruslon Toraboyev",
        aboutDesc1: "I am a professional freelancer with expertise in multiple domains including translation, web design, and 3D modeling. With years of experience, I deliver high-quality work that meets client expectations.",
        aboutDesc2: "My approach focuses on understanding client needs, clear communication, and delivering projects on time. I'm fluent in multiple languages and can work with clients from diverse backgrounds.",
        skillsTitle: "My Skills",
        skill1: "Web Design & Development",
        skill2: "Graphic Design & Logo Creation",
        skill3: "3D Modeling & Rendering",
        skill4: "Multilingual Translation",
        skill5: "Brand Development",
        portfolioTitle: "Completed Projects",
        project1: "E-commerce Website",
        project1Desc: "Fully responsive online store with payment integration",
        project2: "Brand Identity",
        project2Desc: "Complete branding package for a startup company",
        project3: "3D Product Models",
        project3Desc: "Series of 3D models for product visualization",
        contactTitle: "Get In Touch",
        contactSubtitle: "Contact Information",
        contactDesc: "Feel free to reach out for project inquiries or collaboration opportunities.",
        location: "City, Country",
        footerDesc: "Professional Freelancer Services",
        orderTitle: "Place Your Order",
        serviceLabel: "Service",
        nameLabel: "Your Name",
        whatsappLabel: "WhatsApp Number",
        emailLabel: "Email Address",
        detailsLabel: "Project Details",
        submitOrder: "Submit Order",
        successTitle: "Thank You!",
        successMessage: "Thank you for your order. Ruslon Toraboyev will contact you shortly.",
        orderTime: "Order time:",
        closeBtn: "Close",
        loading: "Loading...",
        success: "Success!",
        error: "Error!",
        connectionOnline: "Online",
        connectionOffline: "Offline",
        retry: "Try Again"
    },
    ru: {
        home: "–ì–ª–∞–≤–Ω–∞—è",
        services: "–£—Å–ª—É–≥–∏",
        about: "–û–±–æ –º–Ω–µ",
        portfolio: "–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ",
        heroTitle: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –§—Ä–∏–ª–∞–Ω—Å –£—Å–ª—É–≥–∏",
        heroDesc: "–í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—Ä–∏–ª–∞–Ω—Å-—É—Å–ª—É–≥–∏ —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –¥–µ—Ç–∞–ª—è–º –∏ –±—ã—Å—Ç—Ä—ã–º–∏ —Å—Ä–æ–∫–∞–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –î–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–∞—Ö.",
        servicesBtn: "–ú–æ–∏ –£—Å–ª—É–≥–∏",
        contactBtn: "–°–≤—è–∑–∞—Ç—å—Å—è",
        servicesTitle: "–ú–æ–∏ –£—Å–ª—É–≥–∏",
        service1: "–ü–µ—Ä–µ–≤–æ–¥—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã",
        service1Desc: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ multiple languages —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –∫—É–ª—å—Ç—É—Ä–Ω–æ–π —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.",
        service2: "–í–µ–±-–¥–∏–∑–∞–π–Ω",
        service2Desc: "–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –¥–∏–∑–∞–π–Ω—ã –≤–µ–±-—Å–∞–π—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã, —É–¥–æ–±–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã.",
        service3: "–î–∏–∑–∞–π–Ω –ª–æ–≥–æ—Ç–∏–ø–∞",
        service3Desc: "–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–∏–µ—Å—è –¥–∏–∑–∞–π–Ω—ã –ª–æ–≥–æ—Ç–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –±—Ä–µ–Ω–¥–∞.",
        service4: "–£–ª—É—á—à–µ–Ω–∏–µ –≤–µ–±-—Å–∞–π—Ç–∞",
        service4Desc: "–£–ª—É—á—à–∏—Ç–µ —Å–≤–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≤–µ–±-—Å–∞–π—Ç —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º.",
        service5: "–†–∞–∑–≤–∏—Ç–∏–µ –±—Ä–µ–Ω–¥–∞",
        service5Desc: "–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —É—Å–ª—É–≥–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é –±—Ä–µ–Ω–¥–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –Ω–∞ —Ä—ã–Ω–∫–µ.",
        service6: "3D –≤–∏–∑–∏—Ç–∫–∏",
        service6Desc: "–ò–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∏–∑–∞–π–Ω—ã 3D –≤–∏–∑–∏—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–≤–ª—è—é—Ç lasting impression.",
        service7: "3D –º–æ–¥–µ–ª–∏",
        service7Desc: "–î–µ—Ç–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ 3D –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –æ—Ç—Ä–∞—Å–ª–µ–π.",
        service8: "–ë–∞–Ω–Ω–µ—Ä—ã –∏ —Ä–µ–∫–ª–∞–º–∞",
        service8Desc: "–ü—Ä–∏–≤–ª–µ–∫–∞—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏–µ –±–∞–Ω–Ω–µ—Ä—ã –∏ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è –∫–Ω–∏–≥, –ø—Ä–æ–º–æ–∞–∫—Ü–∏–π –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.",
        orderNow: "–ó–∞–∫–∞–∑–∞—Ç—å –°–µ–π—á–∞—Å",
        aboutTitle: "–û–±–æ –ú–Ω–µ",
        aboutSubtitle: "–†—É—Å–ª–æ–Ω –¢–æ—Ä–∞–±–æ–µ–≤",
        aboutDesc1: "–Ø –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä —Å –æ–ø—ã—Ç–æ–º —Ä–∞–±–æ—Ç—ã –≤ multiple domains, –≤–∫–ª—é—á–∞—è –ø–µ—Ä–µ–≤–æ–¥, –≤–µ–±-–¥–∏–∑–∞–π–Ω –∏ 3D –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ. –ò–º–µ—è –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–π –æ–ø—ã—Ç, —è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –æ–∂–∏–¥–∞–Ω–∏—è–º –∫–ª–∏–µ–Ω—Ç–æ–≤.",
        aboutDesc2: "–ú–æ–π –ø–æ–¥—Ö–æ–¥ focuses on –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –∫–ª–∏–µ–Ω—Ç–æ–≤, —á–µ—Ç–∫–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–µ–π –∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π delivery –ø—Ä–æ–µ–∫—Ç–æ–≤. –Ø —Å–≤–æ–±–æ–¥–Ω–æ –≤–ª–∞–¥–µ—é multiple languages –∏ –º–æ–≥—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω.",
        skillsTitle: "–ú–æ–∏ –ù–∞–≤—ã–∫–∏",
        skill1: "–í–µ–±-–¥–∏–∑–∞–π–Ω –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞",
        skill2: "–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–æ–≥–æ—Ç–∏–ø–æ–≤",
        skill3: "3D –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥",
        skill4: "–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥",
        skill5: "–†–∞–∑–≤–∏—Ç–∏–µ –±—Ä–µ–Ω–¥–∞",
        portfolioTitle: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ü—Ä–æ–µ–∫—Ç—ã",
        project1: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω",
        project1Desc: "–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–µ–π",
        project2: "–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –±—Ä–µ–Ω–¥–∞",
        project2Desc: "–ü–æ–ª–Ω—ã–π –ø–∞–∫–µ—Ç –±—Ä–µ–Ω–¥–∏–Ω–≥–∞ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞–ø-–∫–æ–º–ø–∞–Ω–∏–∏",
        project3: "3D –º–æ–¥–µ–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",
        project3Desc: "–°–µ—Ä–∏—è 3D –º–æ–¥–µ–ª–µ–π –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤",
        contactTitle: "–°–≤—è–∑–∞—Ç—å—Å—è",
        contactSubtitle: "–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
        contactDesc: "–ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞.",
        location: "–ì–æ—Ä–æ–¥, –°—Ç—Ä–∞–Ω–∞",
        footerDesc: "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –§—Ä–∏–ª–∞–Ω—Å –£—Å–ª—É–≥–∏",
        orderTitle: "–†–∞–∑–º–µ—Å—Ç–∏—Ç–µ –í–∞—à –ó–∞–∫–∞–∑",
        serviceLabel: "–£—Å–ª—É–≥–∞",
        nameLabel: "–í–∞—à–µ –ò–º—è",
        whatsappLabel: "–ù–æ–º–µ—Ä WhatsApp",
        emailLabel: "Email –ê–¥—Ä–µ—Å",
        detailsLabel: "–î–µ—Ç–∞–ª–∏ –ü—Ä–æ–µ–∫—Ç–∞",
        submitOrder: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ó–∞–∫–∞–∑",
        successTitle: "–°–ø–∞—Å–∏–±–æ!",
        successMessage: "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –∑–∞–∫–∞–∑. –†—É—Å–ª–æ–Ω –¢–æ—Ä–∞–±–æ–µ–≤ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
        orderTime: "–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞:",
        closeBtn: "–ó–∞–∫—Ä—ã—Ç—å",
        loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
        success: "–£—Å–ø–µ—Ö!",
        error: "–û—à–∏–±–∫–∞!",
        connectionOnline: "–û–Ω–ª–∞–π–Ω",
        connectionOffline: "–û—Ñ—Ñ–ª–∞–π–Ω",
        retry: "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"
    }
};

// Current language
let currentLang = 'en';

// DOM Elements
const header = document.getElementById('header');
const hamburger = document.getElementById('hamburger');
const navMenu = document.getElementById('nav-menu');
const languageBtns = document.querySelectorAll('.language-btn');
const orderBtns = document.querySelectorAll('.order-btn');
const orderModal = document.getElementById('order-modal');
const closeOrderModal = document.getElementById('close-order-modal');
const orderForm = document.getElementById('order-form');
const serviceInput = document.getElementById('service');
const successModal = document.getElementById('success-modal');
const closeSuccessModal = document.getElementById('close-success-modal');
const orderTime = document.getElementById('order-time');
const typingElement = document.querySelector('.typing-effect');
const formLoading = document.getElementById('form-loading');
const submitOrderBtn = document.getElementById('submit-order-btn');

// Typing Animation
const typingTexts = ['Freelance Services', 'Web Design', '3D Modeling', 'Translation'];
let textIndex = 0;
let charIndex = 0;
let isDeleting = false;

function type() {
    const currentText = typingTexts[textIndex];
    
    if (isDeleting) {
        typingElement.textContent = currentText.substring(0, charIndex - 1);
        charIndex--;
    } else {
        typingElement.textContent = currentText.substring(0, charIndex + 1);
        charIndex++;
    }
    
    let typeSpeed = isDeleting ? 50 : 100;
    
    if (!isDeleting && charIndex === currentText.length) {
        typeSpeed = 2000;
        isDeleting = true;
    } else if (isDeleting && charIndex === 0) {
        isDeleting = false;
        textIndex = (textIndex + 1) % typingTexts.length;
        typeSpeed = 500;
    }
    
    setTimeout(type, typeSpeed);
}

// Scroll Animation
function checkScroll() {
    const sections = document.querySelectorAll('section');
    const windowHeight = window.innerHeight;
    
    sections.forEach(section => {
        const sectionTop = section.getBoundingClientRect().top;
        if (sectionTop < windowHeight - 100) {
            section.classList.add('visible');
            
            // Animate service cards with delay
            if (section.id === 'services') {
                const serviceCards = document.querySelectorAll('.service-card');
                serviceCards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('visible');
                    }, index * 150);
                });
            }
        }
    });
    
    // Header background on scroll
    if (window.scrollY > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
}

// Change Language
function changeLanguage(lang) {
    currentLang = lang;
    
    // Update language buttons
    languageBtns.forEach(btn => {
        if (btn.dataset.lang === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
    
    // Update all elements with data-lang-key
    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (translations[lang][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });
}

// Order Modal
function openOrderModal(service) {
    serviceInput.value = service;
    orderModal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeModals() {
    orderModal.classList.remove('active');
    successModal.classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Show notification
function showNotification(message, type = 'success') {
    // Remove existing notifications
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());
    
    // Create new notification
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-exclamation-triangle'}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(notification);
    
    // Show notification
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Hide notification after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.remove();
        }, 300);
    }, 5000);
}

// Form validation
function validateForm() {
    let isValid = true;
    
    // Reset all error states
    document.querySelectorAll('.form-group').forEach(group => {
        group.classList.remove('error');
    });
    
    // Validate name
    const name = document.getElementById('name').value.trim();
    if (!name) {
        document.querySelector('[for="name"]').parentElement.classList.add('error');
        isValid = false;
    }
    
    // Validate WhatsApp
    const whatsapp = document.getElementById('whatsapp').value.trim();
    if (!whatsapp) {
        document.querySelector('[for="whatsapp"]').parentElement.classList.add('error');
        isValid = false;
    }
    
    // Validate email
    const email = document.getElementById('email').value.trim();
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email || !emailRegex.test(email)) {
        document.querySelector('[for="email"]').parentElement.classList.add('error');
        isValid = false;
    }
    
    // Validate details
    const details = document.getElementById('details').value.trim();
    if (!details) {
        document.querySelector('[for="details"]').parentElement.classList.add('error');
        isValid = false;
    }
    
    return isValid;
}

// Form Submission (backend bilan ishlaydigan versiya)
async function handleOrderSubmit(e) {
    e.preventDefault();
    
    // Validate form
    if (!validateForm()) {
        showNotification('Please fill all required fields correctly.', 'error');
        return;
    }
    
    // Get form values
    const name = document.getElementById('name').value;
    const whatsapp = document.getElementById('whatsapp').value;
    const email = document.getElementById('email').value;
    const details = document.getElementById('details').value;
    const service = serviceInput.value;
    
    // Show loading, hide submit button
    if (formLoading && submitOrderBtn) {
        formLoading.style.display = 'block';
        submitOrderBtn.style.display = 'none';
    }
    
    try {
        // Backendga so'rov yuborish
        const response = await fetch('/api/orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name,
                whatsapp,
                email,
                service,
                details
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || `Server error: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error);
        }
        
        // LocalStorage ga ham saqlaymiz (backup sifatida)
        saveOrderToLocalStorage(name, whatsapp, email, service, details);
        
        // Show success notification
        showNotification('Order submitted successfully!', 'success');
        
        // Close order modal and show success modal
        closeModals();
        
        // Set order time
        const now = new Date();
        if (orderTime) {
            orderTime.textContent = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }
        
        // Show success modal
        successModal.classList.add('active');
        
        // Reset form
        orderForm.reset();
        
    } catch (error) {
        console.error('Error:', error);
        
        // Agar backend ishlamasa, faqat localStorage ga saqlaymiz
        saveOrderToLocalStorage(name, whatsapp, email, service, details);
        
        showNotification('Order saved locally. We will contact you soon!', 'warning');
        
        // Close order modal and show success modal
        closeModals();
        
        // Set order time
        const now = new Date();
        if (orderTime) {
            orderTime.textContent = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }
        
        // Show success modal
        successModal.classList.add('active');
        
        // Reset form
        orderForm.reset();
    } finally {
        // Hide loading, show submit button
        if (formLoading && submitOrderBtn) {
            formLoading.style.display = 'none';
            submitOrderBtn.style.display = 'block';
        }
    }
}

// LocalStorage ga buyurtma saqlash
function saveOrderToLocalStorage(name, whatsapp, email, service, details) {
    try {
        // Get existing orders from localStorage
        const existingOrders = JSON.parse(localStorage.getItem('orders')) || [];
        
        // Create new order
        const newOrder = {
            id: Date.now(),
            name,
            whatsapp,
            email,
            service,
            details,
            orderTime: new Date().toISOString(),
            status: 'pending'
        };
        
        // Add to orders array
        existingOrders.push(newOrder);
        
        // Save to localStorage
        localStorage.setItem('orders', JSON.stringify(existingOrders));
        
        console.log('Order saved to localStorage:', newOrder);
        return true;
    } catch (error) {
        console.error('Error saving to localStorage:', error);
        return false;
    }
}

// Service demand tracking
function trackServiceDemand(serviceName) {
    try {
        const demandData = JSON.parse(localStorage.getItem('serviceDemand')) || {};
        demandData[serviceName] = (demandData[serviceName] || 0) + 1;
        localStorage.setItem('serviceDemand', JSON.stringify(demandData));
        
        // Backendga ham yuborish (agar ulanish bo'lsa)
        fetch('/api/service-demand', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                service: serviceName,
                timestamp: new Date().toISOString()
            })
        }).catch(error => console.error('Failed to track service demand:', error));
    } catch (error) {
        console.error('Error tracking service demand:', error);
    }
}

// Event Listeners
window.addEventListener('scroll', checkScroll);
window.addEventListener('load', checkScroll);

if (hamburger) {
    hamburger.addEventListener('click', () => {
        navMenu.classList.toggle('active');
    });
}

// Close mobile menu when clicking on links
document.querySelectorAll('nav a').forEach(link => {
    link.addEventListener('click', () => {
        navMenu.classList.remove('active');
    });
});

if (languageBtns.length > 0) {
    languageBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            changeLanguage(btn.dataset.lang);
        });
    });
}

if (orderBtns.length > 0) {
    orderBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            openOrderModal(btn.dataset.service);
            trackServiceDemand(btn.dataset.service);
        });
    });
}

if (closeOrderModal) {
    closeOrderModal.addEventListener('click', closeModals);
}

if (closeSuccessModal) {
    closeSuccessModal.addEventListener('click', closeModals);
}

if (orderForm) {
    orderForm.addEventListener('submit', handleOrderSubmit);
}

// Close modal when clicking outside
document.addEventListener('click', (e) => {
    if (e.target === orderModal || e.target === successModal) {
        closeModals();
    }
});

// Close modal when pressing Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeModals();
    }
});

// Real-time form validation
if (orderForm) {
    orderForm.querySelectorAll('input, textarea').forEach(input => {
        input.addEventListener('blur', () => {
            validateForm();
        });
        
        input.addEventListener('input', () => {
            // Remove error state when user starts typing
            if (input.value.trim()) {
                input.parentElement.classList.remove('error');
            }
        });
    });
}
document.getElementById("order-form").addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const product = document.getElementById("product").value.trim();

  if (!name || !phone || !product) {
    document.getElementById("message").textContent = "‚ùå Barcha maydonlarni to‚Äòldiring!";
    return;
  }

  try {
    const response = await fetch("/api/orders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name, phone, product })
    });

    if (response.ok) {
      document.getElementById("message").textContent = "‚úÖ Buyurtma yuborildi!";
      document.getElementById("order-form").reset();
    } else {
      document.getElementById("message").textContent = "‚ùå Xatolik yuz berdi!";
    }
  } catch (error) {
    console.error("Xatolik:", error);
    document.getElementById("message").textContent = "‚ùå Server ishlamayapti!";
  }
});

// Initialize
type();
checkScroll();

// Check if there are any orders in localStorage on page load
window.addEventListener('load', () => {
    const orders = JSON.parse(localStorage.getItem('orders')) || [];
    console.log('Orders in localStorage:', orders.length);
});
```

